<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CX Trade - Modern Trading</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
    /* --- FUENTES --- */
    @font-face { font-family: 'BDO Grotesk'; src: url('./fonts/BDOGrotesk-Regular.ttf') format('truetype'); font-weight: 400; font-display: swap; }
    @font-face { font-family: 'BDO Grotesk'; src: url('./fonts/BDOGrotesk-Medium.ttf') format('truetype'); font-weight: 500; font-display: swap; }
    @font-face { font-family: 'BDO Grotesk'; src: url('./fonts/BDOGrotesk-Bold.ttf') format('truetype'); font-weight: 700; font-display: swap; }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    html, body { 
        height: 100%; 
        overflow: hidden; 
        font-family: 'BDO Grotesk', 'Space Grotesk', sans-serif;
        background: #000;
        color: #fff;
    }

    #root { height: 100%; }

    /* Estilos personalizados para scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #1a1a1a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #444; }

    /* Animaciones suaves */
    * { transition: background-color 0.15s ease, transform 0.15s ease; }
    
    /* Prevenir zoom en iOS */
    input, select, textarea { font-size: 16px !important; }

    /* Estilo para botones de operación con ancho fijo */
    .operation-button {
        min-width: 180px;
        max-width: 180px;
        width: 180px !important;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #000 !important;
    }

    .operation-button-text {
        font-size: 13px;
        font-weight: 600;
        line-height: 1.2;
        text-align: center;
        color: #000 !important;
    }

    .operation-button-timer {
        font-size: 11px;
        font-weight: 500;
        margin-top: 2px;
        color: #000 !important;
    }

    @media (max-width: 768px) {
        .operation-button {
            min-width: 140px;
            max-width: 140px;
            width: 140px !important;
        }
    }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const ICONS = {
            search: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/search.png',
            loader: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/loader.png',
            trendingUp: './svg/up.svg',
            trendingDown: './svg/up.svg',
            wifiOff: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/wifiOff.png',
            activity: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/activity.png',
            bell: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/bell.png',
            user: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/user.png',
            stats: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/stats.png',
            settings: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/settings.png',
            menu: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/menu.png',
            close: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/close.png',
            checkCircle: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/check-circle.png',
            xCircle: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/x-circle.png',
            alertCircle: 'https://raw.githubusercontent.com/etalox/cxtrading/main/png/alert-circle.png',
        };

        function TradingApp() {
            const [activeTab, setActiveTab] = useState('markets');
            const [searchQuery, setSearchQuery] = useState('');
            const [isLoading, setIsLoading] = useState(true);
            const [isOnline, setIsOnline] = useState(true);
            const [notifications, setNotifications] = useState([]);
            const [buttonStates, setButtonStates] = useState({ buy: { status: 'ready', timer: 0, opId: null }, sell: { status: 'ready', timer: 0, opId: null } });
            const [activeOperations, setActiveOperations] = useState([]);
            const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
            const [showMobileMenu, setShowMobileMenu] = useState(false);
            const [balance, setBalance] = useState(10000);
            const [marketData, setMarketData] = useState([
                { id: 1, symbol: 'BTC/USD', name: 'Bitcoin', price: 45234.56, change: 2.34, volume: '2.4B', trend: 'up' },
                { id: 2, symbol: 'ETH/USD', name: 'Ethereum', price: 3234.78, change: -1.23, volume: '1.8B', trend: 'down' },
                { id: 3, symbol: 'EUR/USD', name: 'Euro', price: 1.0834, change: 0.45, volume: '890M', trend: 'up' },
            ]);

            useEffect(() => {
                const handleResize = () => setIsMobile(window.innerWidth <= 768);
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            useEffect(() => {
                const timer = setTimeout(() => setIsLoading(false), 1500);
                return () => clearTimeout(timer);
            }, []);

            useEffect(() => {
                const handleOnline = () => setIsOnline(true);
                const handleOffline = () => setIsOnline(false);
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            // Gestión de operaciones activas y timers
            useEffect(() => {
                const interval = setInterval(() => {
                    // Actualizar operaciones activas
                    setActiveOperations(prev => {
                        const updated = prev.map(op => ({
                            ...op,
                            timeLeft: Math.max(0, op.timeLeft - 0.1)
                        })).filter(op => op.timeLeft > 0);

                        // Verificar operaciones completadas
                        const completed = prev.filter(op => op.timeLeft <= 0.1 && op.timeLeft > 0);
                        completed.forEach(op => {
                            handleOperationComplete(op);
                        });

                        return updated;
                    });

                    // Actualizar timers de cooldown (solo desktop)
                    if (!isMobile) {
                        setButtonStates(prev => {
                            const newStates = { ...prev };
                            ['buy', 'sell'].forEach(type => {
                                if (newStates[type].status === 'cooldown' && newStates[type].timer > 0) {
                                    newStates[type] = {
                                        ...newStates[type],
                                        timer: Math.max(0, newStates[type].timer - 0.1)
                                    };
                                    if (newStates[type].timer <= 0) {
                                        newStates[type] = { status: 'ready', timer: 0, opId: null };
                                    }
                                }
                            });
                            return newStates;
                        });
                    }
                }, 100);

                return () => clearInterval(interval);
            }, [isMobile]);

            const handleOperationComplete = (operation) => {
                const success = Math.random() > 0.5;
                const profit = success ? Math.random() * 500 + 100 : -(Math.random() * 300 + 50);

                addNotification(
                    success ? 'success' : 'error',
                    success ? 'Operación cerrada con ganancia' : 'Operación cerrada con pérdida',
                    `${operation.type.toUpperCase()} ${operation.symbol}: ${success ? '+' : ''}$${profit.toFixed(2)}`
                );

                setBalance(prev => prev + profit);

                // En mobile, restaurar el botón cuando termina la operación
                if (isMobile) {
                    setButtonStates(prev => ({
                        ...prev,
                        [operation.type]: { status: 'ready', timer: 0, opId: null }
                    }));
                }
            };

            const executeOperation = (type, symbol) => {
                const maxOps = isMobile ? 1 : 3;
                
                // Verificar límite de operaciones
                if (activeOperations.length >= maxOps) {
                    addNotification('warning', 'Límite alcanzado', `Máximo ${maxOps} operación(es) simultánea(s)`);
                    return;
                }

                // Verificar estado del botón
                if (buttonStates[type].status !== 'ready') {
                    return;
                }

                const duration = Math.random() * 10 + 5; // 5-15 segundos
                const opId = Date.now();
                const newOperation = {
                    id: opId,
                    type,
                    symbol,
                    timeLeft: duration,
                    initialDuration: duration
                };

                setActiveOperations(prev => [...prev, newOperation]);
                
                // Actualizar estado del botón
                setButtonStates(prev => ({
                    ...prev,
                    [type]: { status: 'operating', timer: duration, opId }
                }));

                // En desktop, iniciar cooldown después de la operación
                if (!isMobile) {
                    setTimeout(() => {
                        setButtonStates(prev => {
                            if (prev[type].opId === opId) {
                                return {
                                    ...prev,
                                    [type]: { status: 'cooldown', timer: 5, opId: null }
                                };
                            }
                            return prev;
                        });
                    }, duration * 1000);
                }
            };

            const addNotification = (type, title, message) => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, type, title, message }]);
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== id));
                }, 3000);
            };

            const getButtonContent = (type) => {
                const state = buttonStates[type];
                const activeOp = activeOperations.find(op => op.type === type);

                if (state.status === 'operating' && activeOp) {
                    const actionText = type === 'buy' ? 'COMPRANDO' : 'VENDIENDO';
                    return (
                        <div className="operation-button-text">
                            <div>OPERACIÓN ABIERTA</div>
                            <div>{actionText}... {activeOp.timeLeft.toFixed(1)}s</div>
                        </div>
                    );
                }

                if (state.status === 'cooldown') {
                    return (
                        <div className="operation-button-text">
                            <div>ESPERANDO</div>
                            <div className="operation-button-timer">{state.timer.toFixed(1)}s</div>
                        </div>
                    );
                }

                const duration = Math.random() * 10 + 5;
                return (
                    <div className="operation-button-text">
                        <div>{type === 'buy' ? 'OPERAR COMPRA' : 'OPERAR VENTA'}</div>
                        <div className="operation-button-timer">{type.toUpperCase()} / {duration.toFixed(0)}s</div>
                    </div>
                );
            };

            const isButtonDisabled = (type) => {
                return buttonStates[type].status !== 'ready';
            };

            // Renderizado de notificaciones (sin las de operación abierta/cerrada)
            const NotificationContainer = () => (
                <div style={{ position: 'fixed', top: '80px', right: '20px', zIndex: 1000, display: 'flex', flexDirection: 'column', gap: '12px' }}>
                    {notifications.map(notif => (
                        <div
                            key={notif.id}
                            style={{
                                background: notif.type === 'success' ? '#10b981' : notif.type === 'error' ? '#ef4444' : '#f59e0b',
                                color: '#fff',
                                padding: '12px 16px',
                                borderRadius: '8px',
                                minWidth: '280px',
                                boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
                                animation: 'slideIn 0.3s ease'
                            }}
                        >
                            <div style={{ fontWeight: 600, marginBottom: '4px' }}>{notif.title}</div>
                            <div style={{ fontSize: '13px', opacity: 0.9 }}>{notif.message}</div>
                        </div>
                    ))}
                </div>
            );

            if (isLoading) {
                return (
                    <div style={{ height: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#000' }}>
                        <img src={ICONS.loader} alt="Loading" style={{ width: '48px', height: '48px', animation: 'spin 1s linear infinite' }} />
                    </div>
                );
            }

            return (
                <div style={{ height: '100vh', display: 'flex', flexDirection: 'column', background: '#000' }}>
                    <NotificationContainer />

                    {/* Header */}
                    <div style={{ background: '#0a0a0a', borderBottom: '1px solid #1a1a1a', padding: isMobile ? '12px 16px' : '16px 24px' }}>
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                                <h1 style={{ fontSize: isMobile ? '20px' : '24px', fontWeight: 700 }}>CX Trade</h1>
                                {!isOnline && (
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '6px', color: '#ef4444', fontSize: '13px' }}>
                                        <img src={ICONS.wifiOff} alt="Offline" style={{ width: '16px', height: '16px' }} />
                                        Sin conexión
                                    </div>
                                )}
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: isMobile ? '12px' : '16px' }}>
                                <div style={{ background: '#1a1a1a', padding: '8px 16px', borderRadius: '8px', fontSize: '14px', fontWeight: 600 }}>
                                    ${balance.toFixed(2)}
                                </div>
                                {isMobile ? (
                                    <button onClick={() => setShowMobileMenu(!showMobileMenu)} style={{ background: 'transparent', border: 'none', cursor: 'pointer' }}>
                                        <img src={showMobileMenu ? ICONS.close : ICONS.menu} alt="Menu" style={{ width: '24px', height: '24px' }} />
                                    </button>
                                ) : (
                                    <>
                                        <img src={ICONS.bell} alt="Notifications" style={{ width: '20px', height: '20px', cursor: 'pointer' }} />
                                        <img src={ICONS.user} alt="Profile" style={{ width: '20px', height: '20px', cursor: 'pointer' }} />
                                    </>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div style={{ flex: 1, overflow: 'auto', padding: isMobile ? '16px' : '24px' }}>
                        <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
                            {/* Market Cards */}
                            <div style={{ display: 'grid', gridTemplateColumns: isMobile ? '1fr' : 'repeat(auto-fill, minmax(350px, 1fr))', gap: '20px' }}>
                                {marketData.map(market => (
                                    <div key={market.id} style={{ background: '#0a0a0a', border: '1px solid #1a1a1a', borderRadius: '12px', padding: '20px' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '16px' }}>
                                            <div>
                                                <div style={{ fontSize: '18px', fontWeight: 700, marginBottom: '4px' }}>{market.symbol}</div>
                                                <div style={{ fontSize: '13px', color: '#666' }}>{market.name}</div>
                                            </div>
                                            <div style={{ textAlign: 'right' }}>
                                                <div style={{ fontSize: '20px', fontWeight: 600 }}>${market.price.toLocaleString()}</div>
                                                <div style={{ fontSize: '13px', color: market.change > 0 ? '#10b981' : '#ef4444' }}>
                                                    {market.change > 0 ? '+' : ''}{market.change}%
                                                </div>
                                            </div>
                                        </div>

                                        <div style={{ display: 'flex', gap: '12px', marginTop: '16px' }}>
                                            <button
                                                onClick={() => executeOperation('buy', market.symbol)}
                                                disabled={isButtonDisabled('buy')}
                                                className="operation-button"
                                                style={{
                                                    background: isButtonDisabled('buy') ? '#666' : '#10b981',
                                                    border: 'none',
                                                    borderRadius: '8px',
                                                    padding: '12px',
                                                    cursor: isButtonDisabled('buy') ? 'not-allowed' : 'pointer',
                                                    opacity: isButtonDisabled('buy') ? 0.6 : 1
                                                }}
                                            >
                                                {getButtonContent('buy')}
                                            </button>
                                            <button
                                                onClick={() => executeOperation('sell', market.symbol)}
                                                disabled={isButtonDisabled('sell')}
                                                className="operation-button"
                                                style={{
                                                    background: isButtonDisabled('sell') ? '#666' : '#ef4444',
                                                    border: 'none',
                                                    borderRadius: '8px',
                                                    padding: '12px',
                                                    cursor: isButtonDisabled('sell') ? 'not-allowed' : 'pointer',
                                                    opacity: isButtonDisabled('sell') ? 0.6 : 1
                                                }}
                                            >
                                                {getButtonContent('sell')}
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TradingApp />, document.getElementById('root'));
    </script>

    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</body>
</html>